FROM nvcr.io/nvidia/pytorch:22.12-py3
ENV TZ=Europe/Amsterdam
ENV GPU="True"
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

# have to install python3.11 because the base container still ships 3.8
RUN apt-get update && \
    apt-get install -y software-properties-common gcc && \
    add-apt-repository -y ppa:deadsnakes/ppa && \
    apt-get update && \
    apt-get install -y python3.11

RUN curl -sS https://bootstrap.pypa.io/get-pip.py | python3.11
COPY requirements.txt requirements.txt

RUN pip3.11 install -r requirements.txt && rm -rf /root/.cache/pip/

# after testing: this could be optomized by putting it all on one line
COPY *.py ./
COPY live_model.pickle .

CMD ["gunicorn"  , "-b", "0.0.0.0:8080", "app:app"]
